***\*实验数据处理——爬行轨迹追逐昆虫视频处理程序\****

# 使用说明书

[TOC]

## 说明书更新大纲

1. 10.27 注意：说明书中的实验结果展示图并非都是最新版的。

2. ...

## 1 引言

带控制背包的昆虫仿生机器人具有体型小、运动灵活的优势，可以在复杂地形中行走，到达人和其他设备难以到达的地方，可用于地震灾后救灾、军事战略勘测等。目前，仿生类昆虫机器人已经得到了研究人员的重视。

控制背包的效果是蟑螂仿生机器人的关键指标之一。因此，有很多针对于蟑螂机器人控制背包效果的实验。为了研究控制背包的刺激对蟑螂运动的影响，在实验中测试控制背包性能，需要录制蟑螂运动的视频，并进行分析。通常会在蟑螂的前、后两端贴上标记点，用于定位。在一些情况下，蟑螂不带有标记点。本软件用于在视频中追踪实验蟑螂，适合于带标记点和不带标记点的情况。并计算出几个关键的实验参数，作图得出结果。

此软件说明书编写为了方便用户使用本软件。限于时间和本人能力，本软件在识别场景、功能上难免有不足之处，欢迎广大用户提出宝贵意见。



## 2 软件概述

### 软件用途

本软件采用meanshift算法、camshift算法、颜色过滤、标志点特征提取算子过滤、边缘检测算子过滤五种方法对标记点或蟑螂本身进行位置的提取，得出在视频每一帧中蟑螂的位置、角度信息。同时，对于刺激信号发出的时间，用发光二极管的闪烁来表示，在视频内对发光二极管闪烁的信息进行提取，得出刺激的时间点。主要关注刺激前0.5s，刺激中0.5s和刺激后4s蟑螂的运动变化。采用python语言开发，可用于实验数据处理中的蟑螂轨迹检测，检测结果仅供参考。

### 软件功能

依照蟑螂的实际长度，可以修改视频的输出单位，即拥有视频缩放功能。对于视频缩放功能的说明如下：

> 在视频中选择蟑螂身体的前后两点，给出蟑螂的身体长度，软件会按照比例将输出结果的单位转换为cm，默认为px。

在每一次刺激的前0.5s和到后4.5s的时间段，称为一次刺激。对于输入的视频，本软件可以提取出每一次刺激的帧序号。对于一次刺激的说明如下：

> 出现一次刺激的判断标准为：在某一次二极管闪烁的前0.5s内（或：前0.5\*fps 帧内）未检测到二极管闪烁，在后0.5s内，检测到重复出现二极管闪烁的，即为一次刺激。两次刺激的间隔至少为0.5s。

对于蟑螂的运动状态检测，对于每一次刺激，主要有以下几个指标：

> （1）运动轨迹和转向半径
> （2）身体角度、转向角度和角速度的变化
> （3）摆动角速度的变化

**对于各个指标的说明如下：**

（1）运动轨迹

用蟑螂中心点在视频中的绝对坐标（单位：像素）来代表蟑螂的绝对位置，其换算关系是，位置 = 坐标*比例尺。软件输出每一帧中识别到的蟑螂中心点在视频中的绝对坐标，展现在一张二位平面图上，用以表征蟑螂的运动轨迹。

（2）转向半径

即（1）中轨迹的曲率半径，用轨迹中相邻三点的差分代替微分计算。单位：像素

```
改动：
由于差分计算要求前后两次数据在时间上相邻，要求较高。考虑到曲率半径的计算与时间无关，仅与路径有关...
最后改为用总路程除以总转向角度作为平均角速度
```

（3）身体角度和转向角度

身体角度用首、尾标记点之间坐标连线的倾斜角来表示（单位：°），转向角度即身体角度的变化，转向角度 = 某一帧的身体角度 - 第一帧的身体角度。

（4）转向角速度

相邻两帧之间的相对转向角度除以时间（单位：°/s)

（5）摆动角速度

摆动角速度 = （头角速度 + 尾角速度）/ 2 - 转向角速度（单位：°/s)。

头尾角速度的计算方法是按照首、尾标记点轨迹数据，类似转向角速度进行计算。

**对四种检测方法的说明如下：**

（1）基于meanshift算法的检测

手动选择前、后两个标记点的矩形框。（注意：不要选择整只蟑螂，选框尽量贴近标记点边缘）要求标记点和周围的差异比较明显。程序会自动追踪前后两个标记点的位置，并由此算出蟑螂的轨迹、旋转角度等各个参数。

（2）基于颜色过滤的检测

适用于标记点带有和蟑螂以及环境都不同的颜色特征的场景（例：背景为黑、白色，蟑螂为深色，标记点分别为浅黄、浅绿色），要求前后两个标记点所带的颜色不同。手动提取前、后两个标记点的颜色信息。

（3）基于边缘检测算子的检测

适用于标记点特征不明确的场景，需要用户预处理出去掉蟑螂的背景图（可以用简单的抠图+纯色填充的方式），不能得出摆动角速度特征。用sobel算子提取出每一帧的边缘，通过原图与背景图的边缘特征作差，得到蟑螂的边缘。根据大于某一阈值的点进行计算，所有点进行线性回归得到斜率、倾斜角，进而得到身体角度；取所有点最大覆盖矩形的中心作为蟑螂的中心，进而得到轨迹等数据。

（4）基于标记点特征的检测

适用于标记点带有叉号、加号和方框特征的场景，要求特征比较明显，具体可参考示例。用相对应的算子提取标记点的特征信息，得到前、后两个标记点的位置，提取效果较好。

```
适用于标记点带有叉号、加号等特征的场景
```

### 软件性能

2.3.1 精度

本软件带有检测精度查看功能。对于提取蟑螂身体角度和中心点的方法（基于边缘检测算子、camshift的方法），利用手动校正估计的方式来估算精度和误差。对于提取前、后两个标记点的方法（其他三种方法），利用前、后标记点间距离（单位：像素）的波动范围来估算精度和误差。

具体使用方法如下：

*主页-》查看结果-》查看精度*

 

2.3.2 速度

基于特征的检测速度最慢，其次是基于边缘检测的检测。基于meanshift、camshift算法的检测与基于颜色特征的检测速度相对较快。请根据自己的需求进行选用。

 2.3.3 适用条件

（1）每段视频中不能手动移动蟑螂的位置，或者遮挡标记点。

（2）蟑螂移动的速度不能大于10像素/帧，否则可能使前、后标记点移动出程序的视野范围之内，影响检测效果。

（3）基于标记点特征的识别只包括标记点带叉号、加号和方框三种情况。

```
修改：可以用于更多情况
```



 

### 软件结构

软件结构如图1所示。

<img src="C:\Users\LENOVO\AppData\Roaming\Typora\typora-user-images\image-20230909100056354.png" alt="image-20230909100056354" style="zoom: 80%;" />
